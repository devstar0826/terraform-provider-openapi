# <img src="http://goa.design/img/goa-logo.svg">

This example was created using [goa](https://goa.design/) framework. Using goa we have created a service provider that 
exposes a resource for managing 'Bottles' allowing the consumer to create and read bottles.

## Overview

goa is a framework for building micro-services and REST APIs in Go using a unique design-first approach.

This example service provider APIs have been designed using goa's DSL and leveraging the goa framework the server, client,
swagger documentation and a CLI were generated automatically. This is where the real power of goa resides, allowing service
providers to focus on improving their services while still offering good integration capabilities.

The code containing the API design is located in the 'design' folder. This file contains all the information related to
the API from where goa will feed and generate the code desired (e,g: server api, client lib, documentation, cli, etc). In
this example, everything inside the api folder was auto-generated by goa excluding the design/design.go file.

## How to

The folder located at [design folder](https://github.com/dikhan/terraform-provider-openapi/tree/master/examples/goa/api/design) 
contains the API design described using goa DSL. This folder is used by goa to auto-generate the desired files and ib this 
example the command used is as follows:

````
$ cd $GOPATH/github.com/dikhan/terraform-provider-openapi/examples/goa/api
$ goagen bootstrap -d github.com/dikhan/terraform-provider-openapi/examples/goa/api/design
````

Running the above command will auto-generate the application code, application scaffolding, swagger file and a client 
package and tool. In order to run goagen the binary has to be installed in your path, for that follow [goa installation instructions](https://github.com/goadesign/goa/blob/master/README.md#installation))

The output displayed after running goagen will be something like:

````
app
app/contexts.go
app/controllers.go
app/hrefs.go
app/media_types.go
app/user_types.go
app/test
app/test/bottle_testing.go
main.go
bottle.go
tool/cellar-cli
tool/cellar-cli/main.go
tool/cli
tool/cli/commands.go
client
client/client.go
client/bottle.go
client/user_types.go
client/media_types.go
swagger
swagger/swagger.json
swagger/swagger.yaml
````

As you can see, goa can make you save a lot of time. The server side code, client library, API documentation and even a
CLI was created for free by ust running one command. The server side code generated handles all the things related 
to transport and connections, however the actual logic needs to be implemented by the service provider of course.

In this example, the auto-generated [bottle.go](https://github.com/dikhan/terraform-provider-openapi/tree/master/examples/goa/api/bottle.go) file has been updated to use an in-memory db (just a simple
map) so we are able to use the terraform-provider-openapi against the API and manage the resources created.


# Running the example goa API

A dockerfile is provided to run the example in a container.

To build the container:
````
$ cd $GOPATH/github.com/dikhan/terraform-provider-openapi/examples/goa/api
$ docker build -t goa-service-provider-api .
````

To run the container:
````
docker run -p 9090:9090 goa-service-provider-api
````

